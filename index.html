<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Crypto Control V2</title>
    
    <meta name="theme-color" content="#111827">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <link rel="icon" type="image/jpeg" href="./CryptoControl_icon.png">
    <link rel="apple-touch-icon" href="./CryptoControl_icon.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Biblioteca Poderosa para ler Excel (XLSX) e CSV -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gray-900 text-gray-100 font-sans min-h-screen flex flex-col relative select-none">

    <div id="topProgressBarContainer"><div id="topProgressBar"></div></div>

    <div id="helpModal" class="fixed inset-0 bg-black/90 hidden z-[140] flex items-center justify-center backdrop-blur-sm p-4">
        <div class="glass-panel p-0 rounded-xl w-full max-w-md shadow-2xl relative overflow-hidden border border-gray-700">
            <div class="p-4 border-b border-gray-700 flex justify-between items-center bg-gray-800">
                <h2 class="text-lg font-bold text-white flex items-center gap-2"><i class="fa-solid fa-circle-question text-blue-500"></i> Ajuda</h2>
                <button onclick="document.getElementById('helpModal').classList.add('hidden')" class="text-gray-400 hover:text-white"><i class="fa-solid fa-times"></i></button>
            </div>
            <div class="p-4 sm:p-6 max-h-[70vh] overflow-y-auto space-y-6">

                <!-- Privacidade e Segurança -->
                <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-700 space-y-3">
                    <div class="flex gap-3 items-start bg-red-500/10 border border-red-500/30 rounded-lg p-3">
                        <i class="fa-solid fa-shield-halved text-red-400 text-xl mt-1"></i>
                        <div>
                            <h3 class="text-red-400 font-bold text-sm uppercase">Privacidade Total</h3>
                            <p class="text-xs text-gray-300 mt-1 leading-tight">Seus dados são salvos <strong>somente neste dispositivo</strong>. Não há nuvem. Se limpar o cache, os dados somem. Faça backups!</p>
                        </div>
                    </div>
                    <div class="flex gap-3 items-start bg-yellow-500/10 border border-yellow-500/30 rounded-lg p-3">
                        <i class="fa-solid fa-triangle-exclamation text-yellow-400 text-xl mt-1"></i>
                        <div>
                            <h3 class="text-yellow-400 font-bold text-sm uppercase">Aviso de Privacidade XPUB</h3>
                            <p class="text-xs text-gray-300 mt-1 leading-tight">Ao importar uma carteira via XPUB, você expõe <strong>todos os seus endereços e transações</strong> a serviços de API externos. Não compartilhe seu XPUB publicamente.</p>
                        </div>
                    </div>
                </div>

                <!-- Funcionalidades Principais -->
                <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-700">
                    <h3 class="text-sm font-bold text-blue-400 mb-3 border-b border-gray-700 pb-2 flex items-center gap-2"><i class="fa-solid fa-info-circle"></i> Funcionalidades Principais</h3>
                    <ul class="space-y-3 text-sm text-gray-300">
                        <li class="flex items-start gap-3">
                            <i class="fa-solid fa-eye text-gray-400 w-4 text-center mt-0.5"></i>
                            <div><strong class="text-gray-200">Ocultar Saldos:</strong> Esconde todos os valores monetários para privacidade em locais públicos.</div>
                        </li>
                        <li class="flex items-start gap-3">
                            <i class="fa-solid fa-sync text-blue-400 w-4 text-center mt-0.5"></i>
                            <div><strong class="text-blue-300">Sincronizar Dados:</strong> Força uma nova busca de todos os preços e dados de histórico da API da CoinGecko.</div>
                        </li>
                        <li class="flex items-start gap-3">
                            <i class="fa-solid fa-scale-balanced text-green-400 w-4 text-center mt-0.5"></i>
                            <div><strong class="text-green-300">Conversor:</strong> Permite converter valores rapidamente entre BRL, USD, BTC e SATS.</div>
                        </li>
                        <li class="flex items-start gap-3">
                            <i class="fa-solid fa-wand-magic-sparkles text-yellow-400 w-4 text-center mt-0.5"></i>
                            <div><strong class="text-yellow-300">Simulador:</strong> Projeta o valor do seu portfólio se o Bitcoin atingir um determinado preço.</div>
                        </li>
                        <li class="flex items-start gap-3">
                            <i class="fa-solid fa-terminal text-green-400 w-4 text-center mt-0.5"></i>
                            <div><strong class="text-green-300">Console:</strong> Exibe logs detalhados sobre as operações do app, como buscas na API e erros.</div>
                        </li>
                        <li class="flex items-start gap-3">
                            <i class="fa-solid fa-gear text-gray-400 w-4 text-center mt-0.5"></i>
                            <div><strong class="text-gray-200">Ajustes:</strong> Permite carregar backups, importar histórico de preços do BTC, e configurar a API.</div>
                        </li>
                    </ul>
                </div>

                <!-- Bugs Comuns (API Gratuita) -->
                <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-700">
                    <h3 class="text-sm font-bold text-orange-400 mb-3 border-b border-gray-700 pb-2 flex items-center gap-2"><i class="fa-solid fa-bug"></i> Bugs Comuns (API Gratuita)</h3>
                    <ul class="space-y-2 text-sm text-gray-300 list-disc pl-5">
                        <li><strong class="text-orange-300">Lentidão:</strong> A API gratuita da CoinGecko pode ser lenta, especialmente ao carregar o histórico de muitas moedas.</li>
                        <li><strong class="text-orange-300">Atraso nos Preços:</strong> Os preços e dados históricos podem ter um pequeno atraso em relação ao mercado em tempo real.</li>
                    </ul>
                </div>

            </div>
        </div>
    </div>

    <div id="simulatorModal" class="fixed inset-0 bg-black/90 hidden z-[135] flex items-center justify-center backdrop-blur-sm p-4">
        <div class="glass-panel p-6 rounded-xl w-full max-w-sm shadow-2xl relative">
            <button onclick="document.getElementById('simulatorModal').classList.add('hidden')" class="absolute top-3 right-3 text-gray-400 hover:text-white"><i class="fa-solid fa-times"></i></button>
            <h2 class="text-lg font-bold mb-4 text-white"><i class="fa-solid fa-wand-magic-sparkles text-yellow-400 mr-2"></i> Simulador</h2>
            <div class="mb-4">
                <label class="text-xs text-gray-400 mb-1 block">Se o Bitcoin valer (USD):</label>
                <input type="number" id="simPriceInput" placeholder="Ex: 150000" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white text-lg focus:border-yellow-500 outline-none">
            </div>
            <button onclick="app.runSimulation()" class="w-full bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-500 hover:to-orange-500 text-white font-bold py-2 rounded shadow-lg">Calcular Patrimônio</button>
            <div id="simResult" class="hidden mt-4 text-center bg-black/30 p-3 rounded border border-gray-700">
                <p class="text-gray-500 text-[10px] uppercase">Projeção</p>
                <div class="text-2xl font-bold text-green-400" id="simTotalValue">...</div>
                <div class="text-xs text-gray-400" id="simProfit">...</div>
            </div>
        </div>
    </div>

    <!-- Converter Modal -->
    <div id="converterModal" class="fixed inset-0 bg-black/90 hidden z-[136] flex items-center justify-center backdrop-blur-sm p-4">
        <div class="glass-panel p-6 rounded-xl w-full max-w-sm shadow-2xl relative">
            <button onclick="app.closeConverterModal()" class="absolute top-3 right-3 text-gray-400 hover:text-white"><i class="fa-solid fa-times"></i></button>
            <h2 class="text-lg font-bold mb-4 text-white"><i class="fa-solid fa-scale-balanced text-green-400 mr-2"></i> Conversor</h2>
            <div class="space-y-3">
                <div>
                    <label class="text-xs text-gray-400 mb-1 block">BRL</label>
                    <input type="number" id="converterBRL" oninput="app.convertValues('brl', this.value)" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:border-green-500 outline-none">
                </div>
                <div>
                    <label class="text-xs text-gray-400 mb-1 block">USD</label>
                    <input type="number" id="converterUSD" oninput="app.convertValues('usd', this.value)" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:border-green-500 outline-none">
                </div>
                <div>
                    <label class="text-xs text-gray-400 mb-1 block">BTC</label>
                    <input type="number" id="converterBTC" oninput="app.convertValues('btc', this.value)" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:border-green-500 outline-none">
                </div>
                <div>
                    <label class="text-xs text-gray-400 mb-1 block">SATS</label>
                    <input type="number" id="converterSATS" oninput="app.convertValues('sats', this.value)" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:border-green-500 outline-none">
                </div>
            </div>
        </div>
    </div>

    <!-- Import Warning Modal -->
    <div id="importWarningModal" class="fixed inset-0 bg-black/90 hidden z-[138] flex items-center justify-center backdrop-blur-sm p-4">
        <div class="glass-panel p-0 rounded-xl w-full max-w-md shadow-2xl relative overflow-hidden">
            <div class="bg-gray-800 p-4 border-b border-gray-700 flex justify-between items-center">
                <h2 class="text-lg font-bold text-white"><i class="fa-solid fa-triangle-exclamation text-red-400 mr-2"></i> Antes de Importar sua Carteira</h2>
                <button onclick="app.closeImportWarningModal()" class="text-gray-400 hover:text-white"><i class="fa-solid fa-times"></i></button>
            </div>
            <div class="p-5 space-y-4 text-sm text-gray-300">
                <div class="bg-blue-500/10 border border-blue-500/30 rounded-lg p-3 flex gap-3">
                    <i class="fa-solid fa-info-circle text-blue-400 text-xl mt-1"></i>
                    <div>
                        <h3 class="text-blue-400 font-bold text-xs uppercase">Importação Somente Leitura</h3>
                        <p class="text-[11px] mt-1 leading-tight">Este app <strong>não pede seed</strong> nem <strong>chaves privadas</strong>. Não temos acesso aos seus fundos. A importação serve apenas para <strong>ler dados públicos da blockchain</strong> (saldo e transações).</p>
                    </div>
                </div>
                
                <p class="text-xs">Serão importados seus <strong>endereços públicos individuais</strong> ou <strong>chaves públicas estendidas</strong> (XPUB/YPUB/ZPUB/TR(x)PUB). A partir disso, o app lerá seu saldo e transações automaticamente.</p>
                
                <div class="bg-red-500/10 border border-red-500/30 rounded-lg p-3 flex gap-3">
                    <i class="fa-solid fa-shield-halved text-red-400 text-xl mt-1"></i>
                    <div>
                        <h3 class="text-red-400 font-bold text-xs uppercase">Alertas de Privacidade Importantes</h3>
                        <ul class="list-disc pl-4 text-[11px] space-y-1 mt-1">
                            <li>Um <strong>XPUB expõe TODOS os endereços derivados</strong> da sua carteira.</li>
                            <li>Com um XPUB, <strong>todo o histórico de transações</strong> da carteira se torna visível.</li>
                            <li><strong>APIs externas que consultarmos verão o XPUB.</strong></li>
                            <li><strong>VOCÊ NÃO DEVE COMPARTILHAR SEU XPUB PUBLICAMENTE.</strong></li>
                        </ul>
                    </div>
                </div>

                <p class="text-xs">Atualmente o app usa a <strong>API gratuita do WalletExplorer</strong> para consultar transações e endereços derivados. APIs gratuitas podem ter limites de requisição e atualização mais lenta.</p>

                <div class="bg-green-500/10 border border-green-500/30 rounded-lg p-3 flex gap-3">
                    <i class="fa-solid fa-lock text-green-400 text-xl mt-1"></i>
                    <div>
                        <h3 class="text-green-400 font-bold text-xs uppercase">Sua Segurança é Prioridade</h3>
                        <p class="text-[11px] mt-1 leading-tight">O app <strong>não guarda nenhum dado pela internet</strong>; tudo fica local no seu dispositivo. Seu Bitcoin continua <strong>seguro na carteira original</strong>. Esta importação <strong>NÃO permite enviar BTC</strong>, assinar transações ou alterar a carteira.</p>
                    </div>
                </div>

                <div class="flex justify-between gap-3 pt-4 border-t border-gray-700">
                    <button onclick="app.proceedImportAddress()" class="flex-1 py-2 bg-green-600 hover:bg-green-500 rounded text-xs text-white font-bold uppercase shadow-lg">Entendi e quero continuar</button>
                    <button onclick="app.closeImportWarningModal()" class="flex-1 py-2 border border-gray-600 hover:bg-gray-700 rounded text-xs text-gray-300 uppercase">Cancelar</button>
                </div>
            </div>
        </div>
    </div>
	<div id="converterModal" class="fixed inset-0 bg-black/90 hidden z-[136] flex items-center justify-center backdrop-blur-sm p-4">
        <div class="glass-panel p-6 rounded-xl w-full max-w-sm shadow-2xl relative">
            <button onclick="app.closeConverterModal()" class="absolute top-3 right-3 text-gray-400 hover:text-white"><i class="fa-solid fa-times"></i></button>
            <h2 class="text-lg font-bold mb-4 text-white"><i class="fa-solid fa-scale-balanced text-green-400 mr-2"></i> Conversor</h2>
            <div class="space-y-3">
                <div>
                    <label class="text-xs text-gray-400 mb-1 block">BRL</label>
                    <input type="number" id="converterBRL" oninput="app.convertValues('brl', this.value)" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:border-green-500 outline-none">
                </div>
                <div>
                    <label class="text-xs text-gray-400 mb-1 block">USD</label>
                    <input type="number" id="converterUSD" oninput="app.convertValues('usd', this.value)" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:border-green-500 outline-none">
                </div>
                <div>
                    <label class="text-xs text-gray-400 mb-1 block">BTC</label>
                    <input type="number" id="converterBTC" oninput="app.convertValues('btc', this.value)" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:border-green-500 outline-none">
                </div>
                <div>
                    <label class="text-xs text-gray-400 mb-1 block">SATS</label>
                    <input type="number" id="converterSATS" oninput="app.convertValues('sats', this.value)" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-white focus:border-green-500 outline-none">
                </div>
            </div>
        </div>
    </div>

    <div id="settingsModal" class="fixed inset-0 bg-black/90 hidden z-[130] flex items-center justify-center backdrop-blur-sm p-4">
        <div class="glass-panel p-0 rounded-xl w-full max-w-lg shadow-2xl relative overflow-hidden border border-gray-700">
            <div class="p-4 border-b border-gray-700 flex justify-between items-center bg-gray-800">
                <h2 class="text-lg font-bold text-white flex items-center gap-2"><i class="fa-solid fa-gear text-gray-400"></i> Ajustes</h2>
                <button onclick="app.closeSettings()" class="text-gray-400 hover:text-white"><i class="fa-solid fa-times"></i></button>
            </div>

            <!-- Abas de Navegação -->
            <div class="bg-gray-900/70 border-b border-gray-700 flex">
                <button class="settings-tab-btn flex-1 p-3 text-sm font-bold text-blue-400 text-center border-b-2 border-blue-400 transition" onclick="app.switchSettingsTab('data', this)">
                    <i class="fa-solid fa-database mr-1 sm:mr-2"></i><span class="hidden sm:inline">Dados</span>
                </button>
                <button class="settings-tab-btn flex-1 p-3 text-sm font-bold text-gray-400 text-center border-b-2 border-transparent transition hover:bg-gray-700/50 hover:text-white" onclick="app.switchSettingsTab('integrations', this)">
                    <i class="fa-solid fa-puzzle-piece mr-1 sm:mr-2"></i><span class="hidden sm:inline">Integrações</span>
                </button>
                <button class="settings-tab-btn flex-1 p-3 text-sm font-bold text-gray-400 text-center border-b-2 border-transparent transition hover:bg-gray-700/50 hover:text-white" onclick="app.switchSettingsTab('system', this)">
                    <i class="fa-solid fa-server mr-1 sm:mr-2"></i><span class="hidden sm:inline">Sistema</span>
                </button>
            </div>

            <div class="p-4 sm:p-6 max-h-[70vh] overflow-y-auto">
                <!-- Conteúdo da Aba: Dados -->
                <div id="tab-content-data" class="settings-tab-content space-y-6">
                    <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-700">
                        <h3 class="text-sm font-bold mb-1 flex items-center text-green-400"><i class="fa-solid fa-file-arrow-down w-5 text-center mr-2"></i>Backup da Carteira</h3>
                        <p class="text-xs text-gray-400">Salve um arquivo .json com suas transações ou carregue um backup existente.</p>
                        <div class="flex gap-2 mt-3">
                            <button onclick="app.smartSave()" class="py-2 px-4 bg-green-600 hover:bg-green-500 rounded text-xs text-white font-bold flex items-center justify-center gap-2 transition w-full"><i class="fa-solid fa-save mr-2"></i>Salvar Backup</button>
                            <button onclick="document.getElementById('importFile').click()" class="py-2 px-4 bg-gray-700 hover:bg-gray-600 rounded text-xs text-white font-bold flex items-center justify-center gap-2 transition w-full"><i class="fa-solid fa-upload mr-2"></i>Ler Backup</button>
                            <input type="file" id="importFile" accept=".json" class="hidden" onchange="app.importData(this)">
                        </div>
                    </div>
                    <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-700">
                        <h3 class="text-sm font-bold mb-1 flex items-center text-purple-400"><i class="fa-solid fa-paste w-5 text-center mr-2"></i>Sincronizar (Texto/JSON)</h3>
                        <p class="text-xs text-gray-400">Copie o código para colar em outro dispositivo.</p>
                        <div class="flex gap-2 mt-3">
                            <input type="text" id="exportCodeInput" readonly class="bg-gray-900 border border-gray-600 rounded p-2 text-xs text-white outline-none focus:border-purple-500 w-full truncate" value="...">
                            <button onclick="app.generateExportCode()" class="py-2 px-4 bg-purple-600 hover:bg-purple-500 rounded text-xs text-white font-bold flex items-center justify-center gap-2 transition"><i class="fa-solid fa-copy"></i></button>
                        </div>
                        <div class="flex gap-2 mt-2">
                            <input type="text" id="importCodeInput" placeholder="Cole o código ou JSON..." class="bg-gray-900 border border-gray-600 rounded p-2 text-xs text-white outline-none focus:border-purple-500 w-full">
                            <button onclick="app.importFromCode()" class="py-2 px-4 bg-gray-700 hover:bg-gray-600 rounded text-xs text-white font-bold flex items-center justify-center gap-2 transition">Importar</button>
                        </div>
                    </div>
                </div>

                <!-- Conteúdo da Aba: Integrações -->
                <div id="tab-content-integrations" class="settings-tab-content hidden space-y-6">
                    <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-700">
                        <h3 class="text-sm font-bold mb-1 flex items-center text-orange-400"><i class="fa-solid fa-file-csv w-5 text-center mr-2"></i>Base de Dados Offline (BTC)</h3>
                        <p class="text-xs text-gray-400">Carregue seu arquivo .xlsx ou .csv com o histórico de preços do Bitcoin em dólar.</p>
                        <p class="text-xs text-gray-500 mt-1">Exemplo: <a href="https://www.bitget.com/pt/price/bitcoin/historical-data?#download" target="_blank" class="text-blue-400 hover:underline">Bitget Historical Data</a></p>
                        <div class="flex gap-2 mt-3">
                            <button onclick="document.getElementById('csvHistoryInput').click()" class="py-2 px-4 bg-orange-600 hover:bg-orange-500 rounded text-xs text-white font-bold flex items-center justify-center gap-2 transition w-full">
                                <i class="fa-solid fa-file-excel mr-2"></i> Carregar Base
                            </button>
                            <input type="file" id="csvHistoryInput" accept=".csv, .xlsx, .xls" class="hidden" onchange="app.importHistoryFile(this)">
                        </div>
                        <div id="csvStatus" class="text-xs text-gray-500 mt-2 text-center">Nenhum arquivo carregado</div>
                        <div id="csvDateRange" class="hidden text-center mt-1"></div>
                    </div>
                    <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-700">
                        <h3 class="text-sm font-bold mb-1 flex items-center text-yellow-400"><i class="fa-brands fa-bitcoin w-5 text-center mr-2"></i>Importar Endereço BTC</h3>
                        <p class="text-xs text-gray-400">Importe transações de um endereço público ou xpub (somente leitura).</p>
                        <div class="flex gap-2 mt-3">
                            <input type="text" id="btcAddressInput" placeholder="Endereço ou xpub..." class="bg-gray-900 border border-gray-600 rounded p-2 text-xs text-white outline-none focus:border-yellow-500 w-full">
                            <button onclick="app.showImportWarningModal()" class="py-2 px-4 bg-yellow-600 hover:bg-yellow-500 rounded text-xs text-white font-bold flex items-center justify-center gap-2 transition">Importar</button>
                        </div>
                        <div id="importBtcStatus" class="text-xs text-gray-500 mt-2 text-center"></div>
                    </div>
                    <div class="bg-gray-800/50 p-4 rounded-lg border border-gray-700">
                        <h3 class="text-sm font-bold mb-1 flex items-center text-blue-400"><i class="fa-solid fa-key w-5 text-center mr-2"></i>API CoinGecko</h3>
                        <p class="text-xs text-gray-400">Use a API gratuita ou adicione sua chave "Pro" para menos limites.</p>
                        <form id="settingsForm" class="space-y-3 mt-3">
                            <div class="flex gap-4 text-sm items-center bg-gray-900/50 rounded-lg p-3">
                                <label class="flex items-center cursor-pointer"><input type="radio" name="apiType" value="free" class="mr-2 h-4 w-4 text-blue-500 bg-gray-700 border-gray-600 focus:ring-blue-500" checked> Gratuita</label>
                                <label class="flex items-center cursor-pointer"><input type="radio" name="apiType" value="key" class="mr-2 h-4 w-4 text-blue-500 bg-gray-700 border-gray-600 focus:ring-blue-500"> Pro</label>
                            </div>
                            <div id="apiKeyField" class="hidden">
                                <input type="text" id="apiKeyInput" placeholder="Sua API Key..." class="bg-gray-900 border border-gray-600 rounded p-2 text-xs text-white outline-none focus:border-blue-500 w-full">
                            </div>
                            <button type="submit" class="py-2 px-4 bg-blue-600 hover:bg-blue-500 rounded text-xs text-white font-bold flex items-center justify-center gap-2 transition w-full"><i class="fa-solid fa-save mr-2"></i>Salvar API</button>
                        </form>
                    </div>
                </div>

                <!-- Conteúdo da Aba: Sistema -->
                <div id="tab-content-system" class="settings-tab-content hidden space-y-6">
                    <div class="p-4 rounded-lg border border-red-500/30 bg-red-900/20">
                        <h3 class="text-sm font-bold mb-1 flex items-center text-red-400"><i class="fa-solid fa-triangle-exclamation w-5 text-center mr-2"></i>Zona de Perigo</h3>
                        <p class="text-xs text-gray-400">Ações nesta seção podem resultar em perda de dados. Use com cuidado.</p>
                        <div class="flex flex-col gap-3 mt-3">
                            <button onclick="app.forceClearCache()" class="py-2 px-4 bg-red-600/20 border border-red-500/50 text-red-400 hover:bg-red-500/30 rounded text-xs font-bold flex items-center justify-center gap-2 transition w-full"><i class="fa-solid fa-broom mr-2"></i>Limpar Cache de Preços</button>
                            <button onclick="localStorage.clear(); location.reload()" class="py-2 px-4 bg-red-600 hover:bg-red-500 rounded text-xs text-white font-bold flex items-center justify-center gap-2 transition w-full"><i class="fa-solid fa-bomb mr-2"></i>Resetar App Completo</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="searchModal" class="fixed inset-0 bg-black/90 hidden z-[120] flex items-center justify-center backdrop-blur-sm p-4">
        <div class="glass-panel p-6 rounded-xl w-full max-w-md shadow-2xl relative">
            <button onclick="document.getElementById('searchModal').classList.add('hidden')" class="absolute top-3 right-3 text-gray-500 hover:text-white"><i class="fa-solid fa-times"></i></button>
            <h2 class="text-lg font-bold mb-4 text-white">Adicionar Moeda</h2>
            <div class="flex gap-2 mb-4">
                <input type="text" id="coinSearchInput" placeholder="Ex: Pepe..." class="flex-1 bg-gray-900 border border-gray-600 rounded p-2 text-white outline-none focus:border-blue-500">
                <button onclick="app.searchCoins()" class="bg-blue-600 px-4 rounded text-white font-bold hover:bg-blue-500"><i class="fa-solid fa-search"></i></button>
            </div>
            <div id="searchResults" class="max-h-48 overflow-y-auto space-y-2 text-xs text-center text-gray-500">Digite para buscar.</div>
        </div>
    </div>

    <div id="consoleModal" class="fixed inset-0 bg-black/80 hidden z-[160] flex items-center justify-center backdrop-blur-sm p-4">
        <div class="glass-panel p-0 rounded-xl w-full max-w-2xl h-[400px] flex flex-col shadow-2xl overflow-hidden">
            <div class="bg-gray-800 p-3 flex justify-between items-center border-b border-gray-700">
                <span class="text-xs font-mono text-green-400">>_ CONSOLE</span>
                <button onclick="document.getElementById('consoleModal').classList.add('hidden')" class="text-white"><i class="fa-solid fa-times"></i></button>
            </div>
            <div id="consoleBody" class="flex-1 bg-black/80 p-3 overflow-y-auto text-[10px] text-gray-300 hacker-font"></div>
            <div class="bg-gray-800 p-2 flex justify-between border-t border-gray-700 text-[10px]">
                <span id="queueStatusText" class="text-gray-500">Idle</span>
                <button onclick="document.getElementById('consoleBody').innerHTML=''" class="text-gray-400 hover:text-white">Limpar</button>
            </div>
        </div>
    </div>

    <!-- MODAL DE EDIÇÃO DE TRANSAÇÃO -->
    <div id="editTxModal" class="fixed inset-0 bg-black/90 hidden z-[150] flex items-center justify-center backdrop-blur-sm p-4">
        <div class="glass-panel p-0 rounded-xl w-full max-w-md shadow-2xl relative overflow-hidden">
            <div class="bg-gray-800 p-4 border-b border-gray-700 flex justify-between items-center">
                <h2 class="text-lg font-bold text-white"><i class="fa-solid fa-pencil text-yellow-400 mr-2"></i> Editar Transação</h2>
                <button onclick="app.closeEditModal()" class="text-gray-400 hover:text-white"><i class="fa-solid fa-times"></i></button>
            </div>
            <div class="p-5">
                <form id="editTxForm" class="space-y-3">
                    <input type="hidden" id="editTxId">
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-[10px] text-gray-400 block mb-1">Moeda</label>
                            <select id="editCoinSelect" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-xs text-white outline-none focus:border-yellow-500"></select>
                        </div>
                        <div>
                            <label class="text-[10px] text-gray-400 block mb-1">Ação</label>
                            <select id="editTypeSelect" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-xs text-white outline-none focus:border-yellow-500">
                                <option value="buy">Comprar</option>
                                <option value="sell">Vender</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-[10px] text-gray-400 block mb-1">Qtd</label>
                            <input type="number" step="any" id="editAmountInput" required class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-xs text-white" placeholder="0.00">
                        </div>
                        <div>
                            <label class="text-[10px] text-gray-400 block mb-1">Preço Unitário</label>
                            <input type="number" step="any" id="editCostInput" required class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-xs text-white" placeholder="Preço de 1 moeda">
                        </div>
                    </div>
                    
                    <div>
                        <label class="text-[10px] text-gray-400 block mb-1">Data</label>
                        <input type="date" id="editDateInput" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-xs text-white">
                    </div>

                    <div class="border-t border-gray-700 pt-3 mt-3">
                         <label class="text-[10px] font-bold text-purple-400 uppercase">Taxas (%)</label>
                        <div class="grid grid-cols-2 gap-3 mt-2">
                            <div>
                                <label class="text-[10px] text-gray-400 block mb-1">Taxa Compra</label>
                                <input type="number" step="0.01" min="0" id="editTaxBuyInput" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-xs text-white" placeholder="0.00">
                            </div>
                            <div>
                                <label class="text-[10px] text-gray-400 block mb-1">Taxa Venda</label>
                                <input type="number" step="0.01" min="0" id="editTaxSellInput" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-xs text-white" placeholder="0.00">
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="w-full bg-yellow-600 hover:bg-yellow-500 text-white font-bold py-2 rounded text-xs shadow-lg transform active:scale-95 transition mt-4">SALVAR ALTERAÇÕES</button>
                </form>
            </div>
        </div>
    </div>

    <!-- MODAL PARA PREENCHIMENTO MANUAL DE PREÇOS -->
    <div id="manualPriceModal" class="fixed inset-0 bg-black/90 hidden z-[170] flex items-center justify-center backdrop-blur-sm p-4">
        <div class="glass-panel p-0 rounded-xl w-full max-w-lg shadow-2xl relative overflow-hidden">
            <div class="bg-gray-800 p-4 border-b border-gray-700">
                <h2 class="text-lg font-bold text-white"><i class="fa-solid fa-dollar-sign text-yellow-400 mr-2"></i> Preços Faltantes</h2>
                <p class="text-xs text-gray-400 mt-1">Não encontramos o preço para as transações abaixo. Por favor, preencha o valor de compra (em USD) para adicioná-las.</p>
            </div>
            <div id="manualPriceForm" class="p-5 max-h-80 overflow-y-auto">
                <!-- As linhas da tabela serão injetadas aqui -->
            </div>
            <div class="bg-gray-800 p-3 border-t border-gray-700 flex justify-end gap-3">
                <button onclick="app.cancelManualPriceEntry()" class="py-2 px-4 border border-gray-600 hover:bg-gray-700 rounded text-xs text-gray-300 uppercase">Cancelar</button>
                <button onclick="app.submitManualPrices()" class="py-2 px-4 bg-green-600 hover:bg-green-500 rounded text-xs text-white font-bold uppercase shadow-lg">Salvar Preços</button>
            </div>
        </div>
    </div>

    <nav class="bg-gray-800/90 backdrop-blur-md border-b border-gray-700 p-3 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <div class="w-8 h-8 rounded-full overflow-hidden shadow-lg border border-blue-500/30">
                    <img src="./CryptoControl_icon.png" class="w-full h-full object-cover" alt="Logo">
                </div>
                <h1 class="text-lg font-bold tracking-tight text-white">Crypto<span class="text-blue-500">Control</span></h1>
            </div>

            <!-- Botão do Menu Mobile (visível em telas pequenas) -->
            <div class="md:hidden">
                <button id="mobile-menu-open-button" class="text-gray-300 hover:text-white p-2">
                    <i class="fa-solid fa-bars text-lg"></i>
                </button>
            </div>
            
            <!-- Menu Desktop (visível em telas médias e grandes) -->
            <div class="hidden md:flex items-center space-x-2">
                <div id="apiStatus" class="flex items-center bg-black/40 px-2 py-1 rounded border border-gray-700/50 text-[10px] mr-1 min-w-[70px] justify-center transition-all">
                    <span class="live-indicator"></span> <span class="text-gray-400 font-mono">...</span>
                </div>

                <div class="flex bg-gray-900 rounded p-0.5 border border-gray-700">
                    <button onclick="app.setCurrency('BRL')" id="btn-currency-brl" class="px-2 py-0.5 text-[10px] font-bold rounded bg-blue-600 text-white transition">BRL</button>
                    <button onclick="app.setCurrency('USD')" id="btn-currency-usd" class="px-2 py-0.5 text-[10px] font-bold rounded text-gray-400 hover:text-white transition">USD</button>
                </div>

                <div class="flex bg-gray-900 rounded p-0.5 border border-gray-700">
                    <button onclick="app.setUnit('BTC')" id="btn-unit-btc" class="px-2 py-0.5 text-[10px] font-bold rounded bg-orange-500 text-white transition">BTC</button>
                    <button onclick="app.setUnit('SATS')" id="btn-unit-sats" class="px-2 py-0.5 text-[10px] font-bold rounded text-gray-400 hover:text-white transition">SATS</button>
                </div>
                
                
                <button onclick="app.openConverterModal()" class="p-1.5 text-green-400 hover:bg-gray-700 rounded transition" title="Conversor"><i class="fa-solid fa-scale-balanced"></i></button>
                <button onclick="document.getElementById('simulatorModal').classList.remove('hidden')" class="p-1.5 text-yellow-400 hover:bg-gray-700 rounded transition" title="Simulador"><i class="fa-solid fa-wand-magic-sparkles"></i></button>
                <button onclick="document.getElementById('helpModal').classList.remove('hidden')" class="p-1.5 text-gray-400 hover:text-white hover:bg-gray-700 rounded transition" title="Ajuda"><i class="fa-solid fa-circle-question"></i></button>
                <button onclick="app.openSettings()" class="p-1.5 text-gray-400 hover:text-white hover:bg-gray-700 rounded transition" title="Ajustes"><i class="fa-solid fa-gear"></i></button>
                <button onclick="app.refreshAll(true)" class="p-1.5 text-blue-400 hover:text-white hover:bg-gray-700 rounded transition" title="Forçar Atualização"><i class="fa-solid fa-sync"></i></button>
                <button onclick="app.toggleConsole()" class="p-1.5 text-gray-500 hover:text-green-400 hover:bg-gray-700 rounded transition" title="Console"><i class="fa-solid fa-terminal"></i></button>
            </div>
        </div>
    </nav>

    <!-- Sidebar do Menu Mobile -->
    <div id="mobile-menu" class="fixed inset-0 bg-black/80 z-[200] hidden backdrop-blur-sm">
        <div id="mobile-menu-sidebar" class="fixed top-0 left-0 h-full w-64 bg-gray-900 border-r border-gray-700 shadow-2xl p-4 transform -translate-x-full transition-transform duration-300 ease-in-out">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-md font-bold text-white">Menu</h2>
                <button id="mobile-menu-close-button" class="text-gray-400 hover:text-white">
                    <i class="fa-solid fa-times text-lg"></i>
                </button>
            </div>
            <div class="flex flex-col space-y-3">
                <!-- Itens do menu para mobile -->
                <div class="flex flex-col space-y-2 text-sm">
                    <span class="text-xs text-gray-500 font-bold uppercase">Moeda</span>
                    <div class="flex bg-gray-800 rounded p-1 border border-gray-700 w-full">
                        <button onclick="app.setCurrency('BRL'); closeMenu();" id="mobile-btn-currency-brl" class="flex-1 py-1 text-xs font-bold rounded text-white transition">BRL</button>
                        <button onclick="app.setCurrency('USD'); closeMenu();" id="mobile-btn-currency-usd" class="flex-1 py-1 text-xs font-bold rounded text-gray-400 hover:text-white transition">USD</button>
                    </div>
                </div>
                <div class="flex flex-col space-y-2 text-sm">
                    <span class="text-xs text-gray-500 font-bold uppercase">Unidade</span>
                    <div class="flex bg-gray-800 rounded p-1 border border-gray-700 w-full">
                        <button onclick="app.setUnit('BTC'); closeMenu();" id="mobile-btn-unit-btc" class="flex-1 py-1 text-xs font-bold rounded text-white transition">BTC</button>
                        <button onclick="app.setUnit('SATS'); closeMenu();" id="mobile-btn-unit-sats" class="flex-1 py-1 text-xs font-bold rounded text-gray-400 hover:text-white transition">SATS</button>
                    </div>
                </div>
                
                <div class="border-t border-gray-700 my-2"></div>

                <button onclick="app.openConverterModal(); closeMenu();" class="flex items-center space-x-3 p-2 text-gray-300 hover:bg-gray-700 rounded transition text-left"><i class="fa-solid fa-scale-balanced text-green-400 w-5 text-center"></i> <span>Conversor</span></button>
                <button onclick="document.getElementById('simulatorModal').classList.remove('hidden'); closeMenu();" class="flex items-center space-x-3 p-2 text-gray-300 hover:bg-gray-700 rounded transition text-left"><i class="fa-solid fa-wand-magic-sparkles text-yellow-400 w-5 text-center"></i> <span>Simulador</span></button>
                <button onclick="app.refreshAll(true); closeMenu();" class="flex items-center space-x-3 p-2 text-gray-300 hover:bg-gray-700 rounded transition text-left"><i class="fa-solid fa-sync text-blue-400 w-5 text-center"></i> <span>Sincronizar Dados</span></button>
                <button onclick="app.toggleConsole(); closeMenu();" class="flex items-center space-x-3 p-2 text-gray-300 hover:bg-gray-700 rounded transition text-left"><i class="fa-solid fa-terminal text-green-400 w-5 text-center"></i> <span>Console</span></button>
                
                <div class="border-t border-gray-700 my-2"></div>

                <button onclick="app.openSettings(); closeMenu();" class="flex items-center space-x-3 p-2 text-gray-300 hover:bg-gray-700 rounded transition text-left"><i class="fa-solid fa-gear text-gray-400 w-5 text-center"></i> <span>Ajustes</span></button>
                <button onclick="document.getElementById('helpModal').classList.remove('hidden'); closeMenu();" class="flex items-center space-x-3 p-2 text-gray-300 hover:bg-gray-700 rounded transition text-left"><i class="fa-solid fa-circle-question text-gray-400 w-5 text-center"></i> <span>Ajuda</span></button>
            </div>
        </div>
    </div>

    <main class="max-w-6xl mx-auto p-4 grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <div class="lg:col-span-1 space-y-6">
            <div class="glass-panel rounded-xl p-6 shadow-lg relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-3 opacity-10 group-hover:opacity-20 transition"><i class="fa-solid fa-wallet text-6xl text-white"></i></div>
                
                <div class="flex items-center mb-1">
                    <h2 class="text-xs font-bold text-gray-400 uppercase mr-2">Patrimônio Total</h2>
                    <button onclick="app.togglePrivacy()" class="text-gray-500 hover:text-white transition text-xs" title="Ocultar/Mostrar Valores">
                        <i class="fa-solid fa-eye" id="privacyIconMobile"></i>
                    </button>
                </div>
                
                <div class="text-3xl font-bold text-white tracking-tight mb-2" id="totalBalance">...</div>
                <div class="text-base text-gray-400 tracking-tight mb-4" id="totalBalanceBTC">...</div>
                <div class="grid grid-cols-2 gap-4 pt-2 border-t border-gray-700/50">
                    <div><div class="text-[10px] text-gray-500 uppercase">Investido</div><div class="text-sm text-gray-300 font-mono" id="totalInvested">...</div></div>
                    <div class="text-right"><div class="text-[10px] text-gray-500 uppercase">Lucro/Prejuízo</div><div class="text-sm font-bold font-mono" id="totalPnL">...</div></div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="glass-panel rounded-xl p-4 shadow-lg relative overflow-hidden">
                    <div class="flex justify-center items-center mb-2">
                        <h3 class="text-xs font-bold text-gray-400 uppercase">Mayer Multiple</h3>
                    </div>
                    <div class="flex items-end gap-2">
                        <div class="text-2xl font-bold text-white" id="mayerValue">---</div>
                        <div class="text-xs text-gray-400 mb-1" id="mayerStatus">Carregando...</div>
                    </div>
                    <div class="w-full bg-gray-800 h-2 mt-2 rounded-full overflow-hidden relative">
                        <div class="absolute top-0 left-0 h-full w-full bg-gradient-to-r from-green-500/30 via-yellow-500/30 to-red-500/30"></div>
                        <div id="mayerIndicator" class="h-full w-1 bg-white absolute top-0 shadow-[0_0_10px_white] transition-all duration-500" style="left: 50%"></div>
                    </div>
                </div>
                <div class="glass-panel rounded-xl p-4 shadow-lg relative overflow-hidden">
                    <div class="flex justify-center items-center mb-2">
                        <h3 class="text-xs font-bold text-gray-400 uppercase">Fear & Greed</h3>
                    </div>
                    <div class="flex items-end gap-2">
                        <div class="text-2xl font-bold text-white" id="fngValue">--</div>
                        <div class="text-xs text-gray-400 mb-1" id="fngClassification">Carregando...</div>
                    </div>
                    <div class="w-full bg-gray-800 h-2 mt-2 rounded-full overflow-hidden relative">
                        <div class="absolute top-0 left-0 h-full w-full bg-gradient-to-r from-red-500/30 via-yellow-500/30 to-green-500/30"></div>
                        <div id="fngIndicator" class="h-full w-1 bg-white absolute top-0 shadow-[0_0_10px_white] transition-all duration-500" style="left: 50%;"></div>
                    </div>
                </div>
            </div>

            <div class="glass-panel rounded-xl p-4 shadow-lg flex flex-col items-center justify-center h-56 relative">
                <h3 class="text-xs font-bold text-gray-400 w-full text-left mb-2">Alocação</h3>
                <canvas id="portfolioChart"></canvas>
                <div id="emptyChartMsg" class="hidden text-gray-500 text-xs absolute">Carteira Vazia</div>
            </div>

            <div id="formContainer" class="bg-gray-800 rounded-xl p-5 border border-gray-700 shadow-lg transition-all duration-300 border-l-4 border-l-blue-500">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-sm font-bold text-white flex items-center">
                        <div id="formIconContainer" class="w-6 h-6 mr-2 flex items-center justify-center bg-gray-700 rounded-full overflow-hidden"></div>
                        Nova Transação
                    </h3>
                    <button onclick="document.getElementById('searchModal').classList.remove('hidden')" class="text-[10px] bg-blue-600 hover:bg-blue-500 text-white px-2 py-1 rounded uppercase font-bold tracking-wide"><i class="fa-solid fa-plus mr-1"></i> Moeda</button>
                </div>
                <form id="txForm" class="space-y-3">
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-[10px] text-gray-400 block mb-1">Moeda</label>
                            <select id="coinSelect" onchange="app.updateFormTheme()" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-xs text-white outline-none focus:border-blue-500"></select>
                        </div>
                        <div>
                            <label class="text-[10px] text-gray-400 block mb-1">Ação</label>
                            <select id="typeSelect" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-xs text-white outline-none focus:border-blue-500"><option value="buy">Comprar</option><option value="sell">Vender</option></select>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="text-[10px] text-gray-400 block mb-1">Qtd <span id="qtyUnitLabel" class="text-orange-500 font-bold text-[9px]">(BTC)</span></label>
                            <input type="number" step="0.00000001" id="amountInput" required class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-xs text-white" placeholder="0.00" oninput="app.calculateBreakEven()">
                        </div>
                        <div>
                            <label class="text-[10px] text-gray-400 block mb-1">Preço Unitário (<span id="costCurrencyLabel">R$</span>)</label>
                            <input type="number" step="0.01" id="costInput" required class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-xs text-white" placeholder="Preço de 1 moeda" oninput="app.calculateBreakEven()">
                        </div>
                    </div>
                    
                    <!-- NOVO: PAINEL DE RESUMO UNIFICADO -->
                    <div id="calculationSummary" class="hidden bg-gray-800/50 border border-gray-700 rounded-lg p-3 mt-3 mb-3">
                        <!-- Linha 1: Total Gasto -->
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-[10px] text-gray-400 uppercase tracking-wider">Total Gasto</span>
                            <span class="text-sm font-bold text-white font-mono" id="calcTotalValue">...</span>
                        </div>
                        <!-- Linha 2: Break-even (Sempre visível dentro do box) -->
                        <div class="flex justify-between items-center pt-2 border-t border-gray-700/50">
                            <div class="flex flex-col">
                                <span class="text-[10px] text-purple-400 font-bold uppercase tracking-wider">Break-even</span>
                                <span class="text-[9px] text-gray-500" id="calcBreakEvenMsg">Venda acima de...</span>
                            </div>
                            <span class="text-sm font-bold text-purple-300 font-mono" id="calcBreakEvenValue">...</span>
                        </div>
                    </div>
                    
                    <div>
                        <label class="text-[10px] text-gray-400 block mb-1">Data <span class="text-blue-300 text-[9px]">(data antiga = busca preço unitário)</span></label>
                        <div class="flex gap-2">
                            <input type="date" id="dateInput" class="flex-1 bg-gray-900 border border-gray-600 rounded p-2 text-xs text-white" onchange="app.smartFetchPrice()">
                            <button type="button" onclick="app.smartFetchPrice()" class="bg-blue-600 hover:bg-blue-500 px-2 rounded text-white text-xs font-bold"><i class="fa-solid fa-sync"></i></button>
                        </div>
                        <div id="smartPriceInfo" class="smart-price-box text-xs text-blue-300 mt-2 hidden">
                            <i class="fa-solid fa-info-circle mr-1"></i> <span id="smartPriceText">Carregando preço...</span>
                        </div>
                    </div>

                    <div class="border-t border-gray-700 pt-3 mt-3">
                        <div class="flex justify-between items-center mb-2">
                            <label class="text-[10px] font-bold text-purple-400 uppercase">Taxas (%)</label>
                            <button type="button" onclick="document.getElementById('taxesHelp').classList.toggle('hidden')" class="text-gray-500 hover:text-purple-400 text-xs">
                                <i class="fa-solid fa-circle-question"></i>
                            </button>
                        </div>
                        
                        <div id="taxesHelp" class="hidden bg-purple-500/10 border border-purple-500/30 rounded p-2 mb-2 text-[10px] text-gray-300">
                            <p><strong>Taxa de Compra:</strong> Taxa sobre valor total (exchange, saque, etc)</p>
                            <p><strong>Taxa de Venda:</strong> Taxa na saída para cálculo do break-even</p>
                        </div>

                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="text-[10px] text-gray-400 block mb-1">Taxa Compra</label>
                                <input type="number" step="0.01" min="0" id="taxBuyInput" value="0" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-xs text-white" placeholder="0.00" onchange="app.calculateBreakEven()">
                            </div>
                            <div>
                                <label class="text-[10px] text-gray-400 block mb-1">Taxa Venda</label>
                                <input type="number" step="0.01" min="0" id="taxSellInput" value="0" class="w-full bg-gray-900 border border-gray-600 rounded p-2 text-xs text-white" placeholder="0.00" onchange="app.calculateBreakEven()">
                            </div>
                        </div>
                    </div>

                    <button type="submit" id="submitBtn" class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 rounded text-xs shadow-lg transform active:scale-95 transition">ADICIONAR</button>
                </form>
            </div>
        </div>

        <div class="lg:col-span-2 space-y-6">
            <div class="glass-panel rounded-xl p-4 shadow-lg border border-gray-700">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="text-xs font-bold text-gray-400">Histórico</h3>
                    <div class="flex bg-gray-800 rounded p-0.5">
                        <button onclick="app.changeRange(30)" id="range30" class="range-btn active px-2 py-0.5 text-[10px] rounded text-gray-400 hover:text-white hover:bg-gray-700 transition">30D</button>
                        <button onclick="app.changeRange(90)" id="range90" class="range-btn px-2 py-0.5 text-[10px] rounded text-gray-400 hover:text-white hover:bg-gray-700 transition">90D</button>
                        <button onclick="app.changeRange(180)" id="range180" class="range-btn px-2 py-0.5 text-[10px] rounded text-gray-400 hover:text-white hover:bg-gray-700 transition">6M</button>
                        <button onclick="app.changeRange(365)" id="range365" class="range-btn px-2 py-0.5 text-[10px] rounded text-gray-400 hover:text-white hover:bg-gray-700 transition">1A</button>
                    </div>
                </div>
                <div class="w-full h-56 relative"><canvas id="historyChart"></canvas></div>
            </div>

            <div id="assetsContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>

            <div class="glass-panel rounded-xl border border-gray-700 overflow-hidden">
                <div class="bg-gray-800/50 p-3 border-b border-gray-700 flex justify-between items-center">
                    <h3 class="text-xs font-bold text-gray-400">Últimas Transações</h3>
                    <div class="flex items-center gap-4">
                        <button onclick="app.exportToCsv()" class="text-[10px] text-blue-400 hover:text-blue-300 flex items-center gap-1">
                            <i class="fa-solid fa-file-export"></i> Exportar
                        </button>
                        <button onclick="app.clearAllData()" class="text-[10px] text-red-400 hover:text-red-300">Limpar Tudo</button>
                    </div>
                </div>
                <div class="overflow-x-auto max-h-60">
                    <table class="w-full text-left text-xs">
                        <thead class="bg-gray-900 text-gray-500 font-normal">
                            <tr><th class="p-3 font-normal">Data</th><th class="p-3 font-normal">Ativo</th><th class="p-3 font-normal">Tipo</th><th class="p-3 text-right font-normal">Qtd</th><th class="p-3 text-right font-normal">Valor</th><th class="p-3 text-right font-normal">B.E.</th><th class="p-3"></th></tr>
                        </thead>
                        <tbody id="historyTableBody" class="divide-y divide-gray-800"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>
    
    <footer class="border-t border-gray-800 mt-6 py-8 text-center bg-gray-900/90 backdrop-blur-md">
        <p class="text-gray-500 text-sm font-mono mb-4">By Arthur Miguel</p>
        <p class="text-xs text-gray-600 font-mono mb-4">v2.3</p>
        <div class="inline-block bg-gray-800/50 rounded-xl p-4 border border-gray-700/50 max-w-sm mx-auto">
        <p class="text-xs text-gray-400 mb-2 px-2"><i class="fa-solid fa-heart text-red-500 mr-2"></i>Se este projeto te ajudou, considere apoiar com um café ☕</p>
            <div class="mb-2 bg-white p-2 rounded-lg inline-block">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=lightning:arthurmiguel@bipa.app" alt="QR" class="w-32 h-32">
            </div>
            <div class="flex items-center gap-2 bg-black/30 rounded p-2 cursor-pointer hover:bg-black/50 transition mb-2" onclick="app.copyLightningAddress()">
                <div class="bg-yellow-500 text-black w-5 h-5 rounded-full flex items-center justify-center"><i class="fa-solid fa-bolt text-[10px]"></i></div>
                <span class="text-[10px] font-mono text-gray-300">arthurmiguel@bipa.app</span>
                <i class="fa-regular fa-copy text-yellow-400 text-lg group-hover:scale-110 transition ml-2"></i>
            </div>
            <div class="flex items-center gap-2 bg-black/30 rounded p-2 cursor-pointer hover:bg-black/50 transition" onclick="app.copyDonationAddress()">
                <i class="fa-brands fa-bitcoin text-gray-500"></i>
                <span class="text-[10px] font-mono text-gray-300 truncate w-48">Bc1qn9gjwevesf8xhqamvt8lcnwmyz4e5lfdqzc7h0</span>
                <i class="fa-regular fa-copy text-gray-500 text-xs"></i>
            </div>
        </div>
    </footer>

    <script src="script.js" defer></script>
</body>
</html>